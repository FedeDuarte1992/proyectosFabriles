<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Documentaci√≥n - Stockeando</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
        }
        .generate-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        .generate-btn:hover {
            background: #218838;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }
        .progress-bar {
            height: 100%;
            background: #28a745;
            width: 0%;
            transition: width 0.3s ease;
        }
        .status {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ Generador de Documentaci√≥n</h1>
            <p>Sistemas de Utilidades - An√°lisis Completo del C√≥digo</p>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Stockeando + Calcular Sueldo</p>
        </div>
        
        <div class="status" id="status">Listo para generar documentaci√≥n</div>
        <div class="progress" id="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <button class="generate-btn" onclick="generateDocumentation()">
            üìÑ Generar Documentaci√≥n Completa PDF
        </button>
        
        <div id="preview" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; display: none;">
            <h3>Vista Previa del Contenido:</h3>
            <div id="previewContent"></div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        // Estructura del sistema y an√°lisis de funciones
        const systemAnalysis = {
            overview: {
                title: "Sistemas de Utilidades - An√°lisis Completo",
                description: "Conjunto de sistemas web para optimizaci√≥n del trabajo: Stockeando (inventario industrial) y Calcular Sueldo (gesti√≥n de n√≥minas).",
                architecture: "Arquitectura cliente-servidor con almacenamiento local y procesamiento en tiempo real",
                technologies: ["HTML5", "CSS3", "JavaScript ES6", "Chart.js", "QR API", "LocalStorage", "Date API", "Canvas API"]
            },
            
            stockeandoSystem: {
                title: "Sistema Stockeando - Gesti√≥n de Inventario",
                description: "Sistema completo para control de inventario industrial con trazabilidad total"
            },
            
            sueldoSystem: {
                title: "Sistema Calcular Sueldo - Gesti√≥n de N√≥minas",
                description: "Herramienta para c√°lculo de sueldos, control de asistencia y generaci√≥n de reportes laborales"
            },
            
            stockeandoFiles: {
                "stockeando.html": {
                    purpose: "P√°gina principal del sistema",
                    functions: [
                        "Navegaci√≥n principal entre m√≥dulos",
                        "Presentaci√≥n de funcionalidades",
                        "Punto de entrada al sistema"
                    ]
                },
                
                "login.html": {
                    purpose: "Sistema de autenticaci√≥n",
                    functions: [
                        "Validaci√≥n de credenciales (admin, admin1, admin2)",
                        "Gesti√≥n de sesiones",
                        "Redirecci√≥n post-login"
                    ]
                },
                
                "auth.js": {
                    purpose: "Gestor de autenticaci√≥n",
                    functions: [
                        "isAuthenticated(): Verifica sesi√≥n activa",
                        "redirectToLogin(): Redirige a login si no autenticado",
                        "logout(): Cierra sesi√≥n y limpia datos",
                        "getCurrentUser(): Obtiene usuario actual",
                        "addLogoutButton(): Agrega bot√≥n de salir"
                    ]
                },
                
                "product-state-manager.js": {
                    purpose: "Gestor central de estados y movimientos",
                    functions: [
                        "getAllMovements(): Obtiene historial completo",
                        "saveMovement(): Guarda movimiento con timestamp",
                        "registerMovement(): Registra movimiento con usuario",
                        "registerRejection(): Registra rechazo con motivo",
                        "getCompleteProductData(): Busca producto en todo el sistema",
                        "getProductStates(): Obtiene estados actuales",
                        "getCurrentLocation(): Ubicaci√≥n actual del producto",
                        "isCodeUnique(): Valida unicidad de c√≥digos",
                        "generateUniqueCode(): Genera c√≥digos √∫nicos",
                        "getMovementStats(): Estad√≠sticas de movimientos",
                        "cleanOldMovements(): Limpia datos antiguos",
                        "exportData(): Exporta para backup",
                        "importData(): Importa desde backup"
                    ]
                },
                
                "inventario.html": {
                    purpose: "Control visual de inventario con drag & drop",
                    functions: [
                        "toggleSection(): Alterna vista de secciones",
                        "showSectionDetail(): Muestra detalle de secci√≥n",
                        "togglePlant(): Alterna vista de plantas",
                        "dropToSection(): Maneja drop en secciones",
                        "dropToPlant(): Maneja drop en plantas",
                        "showProductModal(): Modal para datos de producto",
                        "generateQR(): Genera c√≥digo QR",
                        "confirmProduct(): Confirma ingreso de producto",
                        "dragFromDeposito(): Inicia drag desde dep√≥sito",
                        "allowDrop(): Permite drop en zona v√°lida",
                        "dropToRejected(): Maneja rechazo de productos",
                        "confirmRejection(): Confirma rechazo con motivo",
                        "showRejectionQRModal(): Modal QR de rechazo",
                        "downloadRejectionQR(): Descarga QR de rechazo"
                    ]
                },
                
                "plant-manager.js": {
                    purpose: "Gestor espec√≠fico de plantas y m√°quinas",
                    functions: [
                        "initializePlants(): Inicializa datos de plantas",
                        "loadPlantMaterials(): Carga materiales de planta",
                        "moveToMachine(): Mueve producto a m√°quina",
                        "getMachineData(): Obtiene datos de m√°quinas",
                        "saveMachineData(): Guarda estado de m√°quinas",
                        "loadMachineState(): Carga estado visual",
                        "getInventoryData(): Obtiene inventario general"
                    ]
                },
                
                "movimientos.html": {
                    purpose: "Visualizaci√≥n de historial de movimientos",
                    functions: [
                        "loadMovements(): Carga y agrupa movimientos",
                        "formatMovementDescription(): Formatea descripci√≥n legible",
                        "toggleDateGroup(): Expande/colapsa grupos por fecha",
                        "showProductDetails(): Muestra detalles en modal"
                    ]
                },
                
                "productos.html": {
                    purpose: "Gesti√≥n de cat√°logo de productos",
                    functions: [
                        "loadCategories(): Carga categor√≠as desde storage",
                        "saveCategories(): Guarda categor√≠as actualizadas",
                        "addCategory(): Agrega nueva categor√≠a",
                        "editCategory(): Edita categor√≠a existente",
                        "deleteCategory(): Elimina categor√≠a",
                        "addProduct(): Agrega producto a categor√≠a",
                        "editProduct(): Modifica datos de producto",
                        "deleteProduct(): Elimina producto"
                    ]
                },
                
                "generar-qr.html": {
                    purpose: "Generador de c√≥digos QR",
                    functions: [
                        "generateQR(): Genera QR con datos completos",
                        "updatePreview(): Actualiza vista previa",
                        "downloadQR(): Descarga imagen QR",
                        "validateFields(): Valida campos requeridos"
                    ]
                },
                
                "reportes.html": {
                    purpose: "Sistema de reportes y analytics",
                    functions: [
                        "loadReports(): Carga datos para reportes",
                        "generateChart(): Genera gr√°ficos Chart.js",
                        "filterData(): Filtra datos por criterios",
                        "exportReport(): Exporta reporte a PDF/Excel"
                    ]
                },
                
                "reports-analytics.js": {
                    purpose: "Motor de an√°lisis y reportes",
                    functions: [
                        "generateMovementReport(): Reporte de movimientos",
                        "generateInventoryReport(): Reporte de inventario",
                        "generateUserActivityReport(): Actividad por usuario",
                        "createChart(): Crea gr√°ficos personalizados",
                        "exportToPDF(): Exporta a PDF",
                        "exportToExcel(): Exporta a Excel",
                        "calculateKPIs(): Calcula indicadores clave"
                    ]
                }
            },
            
            sueldoFiles: {
                "calcular-sueldo.html": {
                    purpose: "Calculadora principal de sueldos",
                    functions: [
                        "calculateSalary(): Calcula sueldo con descuentos",
                        "addEmployee(): Agrega nuevo empleado",
                        "editEmployee(): Modifica datos de empleado",
                        "deleteEmployee(): Elimina empleado",
                        "generatePayslip(): Genera recibo de sueldo"
                    ]
                },
                
                "attendance.html": {
                    purpose: "Control de asistencia",
                    functions: [
                        "markAttendance(): Marca asistencia diaria",
                        "calculateHours(): Calcula horas trabajadas",
                        "generateAttendanceReport(): Reporte de asistencia",
                        "exportAttendance(): Exporta datos de asistencia"
                    ]
                },
                
                "reports-sueldo.html": {
                    purpose: "Reportes de n√≥mina",
                    functions: [
                        "generatePayrollReport(): Reporte de n√≥mina",
                        "generateTaxReport(): Reporte fiscal",
                        "generateSummaryReport(): Resumen ejecutivo",
                        "exportReports(): Exporta reportes m√∫ltiples"
                    ]
                }
            },
            
            detailedAnalysis: {
                stockeando: {
                    "Flujo de Datos Principal": {
                        description: "El sistema maneja un flujo de datos complejo desde el ingreso hasta el procesamiento final",
                        steps: [
                            "1. Producto ingresa en TR√ÅNSITO",
                            "2. Validaci√≥n y generaci√≥n de QR obligatorio",
                            "3. Movimiento a DEP√ìSITO con registro completo",
                            "4. Distribuci√≥n a PLANTAS seg√∫n necesidad",
                            "5. Asignaci√≥n a M√ÅQUINAS espec√≠ficas",
                            "6. Seguimiento completo con trazabilidad"
                        ],
                        diagram: "TR√ÅNSITO ‚Üí [QR] ‚Üí DEP√ìSITO ‚Üí PLANTAS ‚Üí M√ÅQUINAS"
                    },
                    
                    "Arquitectura de Datos": {
                        description: "Sistema de almacenamiento distribuido con LocalStorage como base",
                        components: [
                            "movements: Array de todos los movimientos",
                            "products: Cat√°logo de productos disponibles",
                            "inventory: Estado actual del inventario",
                            "plants: Configuraci√≥n de plantas y m√°quinas",
                            "users: Datos de usuarios y sesiones",
                            "categories: Categor√≠as de productos"
                        ]
                    },
                    
                    "Sistema de Autenticaci√≥n": {
                        description: "Control de acceso multi-usuario con seguimiento de actividades",
                        features: [
                            "3 usuarios: admin, admin1, admin2",
                            "Contrase√±a √∫nica: 'admin'",
                            "Sesi√≥n persistente en localStorage",
                            "Tracking de movimientos por usuario",
                            "Logout autom√°tico por inactividad"
                        ]
                    }
                },
                
                sueldo: {
                    "C√°lculo de N√≥mina": {
                        description: "Motor de c√°lculo completo con descuentos legales y beneficios",
                        formula: "Sueldo Neto = Sueldo Bruto - (Seg.Social + Obra Social + Imp.Ganancias)",
                        components: [
                            "Sueldo Bruto: Horas √ó Tarifa por Hora",
                            "Seguridad Social: 11% del bruto",
                            "Obra Social: 3% del bruto",
                            "Impuesto a las Ganancias: Escala progresiva"
                        ]
                    },
                    
                    "Control de Asistencia": {
                        description: "Sistema de registro temporal con c√°lculo autom√°tico de horas",
                        process: [
                            "Registro de entrada (check-in)",
                            "Registro de salida (check-out)",
                            "C√°lculo autom√°tico de horas trabajadas",
                            "Validaci√≥n de horarios laborales",
                            "Generaci√≥n de reportes mensuales"
                        ]
                    }
                }
            },
            
            codeExamples: {
                stockeando: {
                    "Registro de Movimiento - An√°lisis Detallado": {
                        code: `// product-state-manager.js - Funci√≥n Central del Sistema
function registerMovement(productId, fromLocation, toLocation, details = {}) {
    // 1. VALIDACI√ìN DE PAR√ÅMETROS
    if (!productId || !fromLocation || !toLocation) {
        throw new Error('Par√°metros requeridos: productId, fromLocation, toLocation');
    }
    
    // 2. CREACI√ìN DEL OBJETO MOVIMIENTO
    const movement = {
        id: generateUniqueId(),           // ID √∫nico para trazabilidad
        productId: productId,             // Referencia al producto
        from: fromLocation,               // Ubicaci√≥n origen
        to: toLocation,                   // Ubicaci√≥n destino
        timestamp: new Date().toISOString(), // Marca temporal ISO
        user: getCurrentUser(),           // Usuario que ejecuta
        details: {                        // Datos adicionales
            peso: details.peso || null,
            lote: details.lote || null,
            codigo: details.codigo || null,
            motivo: details.motivo || null
        }
    };
    
    // 3. PERSISTENCIA EN LOCALSTORAGE
    const movements = getAllMovements() || [];
    movements.push(movement);
    localStorage.setItem('movements', JSON.stringify(movements));
    
    // 4. ACTUALIZACI√ìN DE ESTADOS
    updateProductLocation(productId, toLocation);
    
    // 5. NOTIFICACI√ìN DEL SISTEMA
    console.log(\`Movimiento registrado: \${productId} de \${fromLocation} a \${toLocation}\`);
    
    return movement;
}`,
                        explanation: [
                            "PASO 1: Valida que todos los par√°metros requeridos est√©n presentes",
                            "PASO 2: Crea objeto movimiento con ID √∫nico y timestamp ISO",
                            "PASO 3: Persiste en localStorage para mantener historial",
                            "PASO 4: Actualiza la ubicaci√≥n actual del producto",
                            "PASO 5: Registra en consola para debugging"
                        ]
                    },
                    
                    "Generaci√≥n de QR - Proceso Completo": {
                        code: `// generar-qr.js - Sistema de C√≥digos QR
function generateQR() {
    // 1. CAPTURA DE DATOS DEL FORMULARIO
    const peso = document.getElementById('peso').value.trim();
    const lote = document.getElementById('lote').value.trim();
    const codigo = document.getElementById('codigo').value.trim();
    
    // 2. VALIDACI√ìN ESTRICTA
    const errors = [];
    // POSIBLE ERROR: peso <= 0 no valida si peso es NaN despu√©s de parseFloat
    if (!peso || peso <= 0) errors.push('Peso debe ser mayor a 0');
    if (!lote) errors.push('Lote es obligatorio');
    if (!codigo) errors.push('C√≥digo interno es obligatorio');
    
    if (errors.length > 0) {
        alert('Errores encontrados:\\n' + errors.join('\\n'));
        return false;
    }
    
    // 3. VERIFICACI√ìN DE UNICIDAD
    // POSIBLE ERROR: No hay try-catch si isCodeUnique() falla
    if (!isCodeUnique(codigo)) {
        alert('El c√≥digo ya existe. Use uno diferente.');
        return false;
    }
    
    // 4. CONSTRUCCI√ìN DEL OBJETO QR
    const qrData = {
        peso: parseFloat(peso), // POSIBLE ERROR: parseFloat puede retornar NaN
        lote: lote.toUpperCase(),
        codigo: codigo.toUpperCase(),
        fechaIngreso: new Date().toISOString(),
        generadoPor: getCurrentUser(), // POSIBLE ERROR: getCurrentUser() puede retornar null
        version: '2.0',
        sistema: 'Stockeando'
    };
    
    // 5. CODIFICACI√ìN Y GENERACI√ìN
    const qrString = JSON.stringify(qrData);
    const encodedData = encodeURIComponent(qrString);
    const qrUrl = \`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=\${encodedData}\`;
    
    // 6. ACTUALIZACI√ìN DE LA INTERFAZ
    const preview = document.getElementById('qrPreview');
    // POSIBLE ERROR: No verifica si el elemento existe antes de usarlo
    preview.src = qrUrl;
    preview.style.display = 'block';
    
    // 7. HABILITACI√ìN DE DESCARGA
    // POSIBLE ERROR: No verifica si downloadBtn existe
    document.getElementById('downloadBtn').style.display = 'block';
    document.getElementById('downloadBtn').onclick = () => downloadQR(qrUrl, codigo);
    
    // 8. REGISTRO EN EL SISTEMA
    // POSIBLE ERROR: No hay manejo de errores si registerQRGeneration falla
    registerQRGeneration(qrData);
    
    return true;
}`,
                        explanation: [
                            "PASO 1: Extrae y limpia datos del formulario HTML",
                            "PASO 2: Valida cada campo con reglas espec√≠ficas",
                            "PASO 3: Verifica que el c√≥digo no exista previamente",
                            "PASO 4: Construye objeto con metadatos completos",
                            "PASO 5: Codifica datos y genera URL del QR",
                            "PASO 6: Actualiza preview en tiempo real",
                            "PASO 7: Habilita funcionalidad de descarga",
                            "PASO 8: Registra la generaci√≥n en el historial"
                        ]
                    },
                    
                    "Drag & Drop - Manejo de Eventos": {
                        code: `// inventario.html - Sistema de Arrastrar y Soltar
function dropToSection(event, sectionId) {
    // 1. PREVENCI√ìN DEL COMPORTAMIENTO DEFAULT
    event.preventDefault();
    event.stopPropagation();
    
    // 2. EXTRACCI√ìN DE DATOS DEL DRAG
    const productId = event.dataTransfer.getData('text/plain');
    const dragSource = event.dataTransfer.getData('application/source');
    
    // 3. VALIDACI√ìN DE ORIGEN
    if (dragSource !== 'transito') {
        showError('Solo se pueden mover productos desde Tr√°nsito');
        return false;
    }
    
    // 4. OBTENCI√ìN DE DATOS COMPLETOS
    const productData = getCompleteProductData(productId);
    if (!productData) {
        showError('Producto no encontrado');
        return false;
    }
    
    // 5. VALIDACI√ìN DE QR OBLIGATORIO
    if (!productData.qrGenerated) {
        showModal({
            title: 'QR Requerido',
            message: 'Debe generar QR antes de mover el producto',
            action: () => redirectToQRGenerator(productId)
        });
        return false;
    }
    
    // 6. CONFIRMACI√ìN DEL USUARIO
    const confirmed = confirm(\`¬øMover \${productData.nombre} a \${sectionId}?\`);
    if (!confirmed) return false;
    
    // 7. REGISTRO DEL MOVIMIENTO
    const movement = registerMovement(productId, 'transito', sectionId, {
        peso: productData.peso,
        lote: productData.lote,
        codigo: productData.codigo,
        timestamp: new Date().toISOString()
    });
    
    // 8. ACTUALIZACI√ìN VISUAL
    updateInventoryDisplay();
    removeFromTransit(productId);
    addToSection(sectionId, productData);
    
    // 9. FEEDBACK AL USUARIO
    showSuccess(\`Producto movido exitosamente a \${sectionId}\`);
    
    // 10. LOG PARA AUDITOR√çA
    console.log('Movement completed:', movement);
    
    return true;
}`,
                        explanation: [
                            "PASO 1: Previene comportamiento default del navegador",
                            "PASO 2: Extrae ID del producto y origen del drag",
                            "PASO 3: Valida que el origen sea v√°lido (solo tr√°nsito)",
                            "PASO 4: Obtiene datos completos del producto",
                            "PASO 5: Verifica QR obligatorio antes del movimiento",
                            "PASO 6: Solicita confirmaci√≥n expl√≠cita del usuario",
                            "PASO 7: Registra el movimiento con todos los detalles",
                            "PASO 8: Actualiza la interfaz visual inmediatamente",
                            "PASO 9: Muestra feedback positivo al usuario",
                            "PASO 10: Registra en consola para auditor√≠a"
                        ]
                    }
                },
                
                sueldo: {
                    "C√°lculo de Sueldo - Motor Completo": {
                        code: `// calcular-sueldo.js - Calculadora Principal
function calculateSalary(employeeId, hoursWorked, hourlyRate, bonuses = {}) {
    // 1. VALIDACI√ìN DE ENTRADA
    // POSIBLE ERROR: No valida si hoursWorked y hourlyRate son n√∫meros v√°lidos (NaN)
    if (!employeeId || hoursWorked < 0 || hourlyRate <= 0) {
        throw new Error('Par√°metros inv√°lidos para c√°lculo de sueldo');
    }
    
    // POSIBLE ERROR: No valida si bonuses es realmente un objeto
    
    // 2. C√ÅLCULO DEL SUELDO BRUTO
    const regularHours = Math.min(hoursWorked, 160); // M√°ximo 160h normales
    const overtimeHours = Math.max(hoursWorked - 160, 0);
    
    const regularPay = regularHours * hourlyRate;
    const overtimePay = overtimeHours * hourlyRate * 1.5; // 50% extra
    const grossSalary = regularPay + overtimePay;
    
    // 3. C√ÅLCULO DE BONIFICACIONES
    // POSIBLE ERROR: Object.values(bonuses) puede fallar si bonuses no es objeto
    // POSIBLE ERROR: No valida si los valores de bonuses son n√∫meros
    const totalBonuses = Object.values(bonuses).reduce((sum, bonus) => sum + bonus, 0);
    const adjustedGross = grossSalary + totalBonuses;
    
    // 4. C√ÅLCULO DE DESCUENTOS LEGALES
    const socialSecurity = adjustedGross * 0.11;     // 11% Seguridad Social
    const healthInsurance = adjustedGross * 0.03;    // 3% Obra Social
    const unionFee = adjustedGross * 0.025;          // 2.5% Sindicato
    
    // 5. IMPUESTO A LAS GANANCIAS (Escala progresiva)
    let incomeTax = 0;
    // POSIBLE ERROR: Valores hardcodeados (150000, 50000) deber√≠an ser configurables
    if (adjustedGross > 150000) {
        const taxableAmount = adjustedGross - 150000;
        if (taxableAmount <= 50000) {
            incomeTax = taxableAmount * 0.05;        // 5% primera escala
        } else {
            incomeTax = 50000 * 0.05 + (taxableAmount - 50000) * 0.09; // 9% segunda escala
        }
    }
    
    // 6. C√ÅLCULO FINAL
    const totalDeductions = socialSecurity + healthInsurance + unionFee + incomeTax;
    const netSalary = adjustedGross - totalDeductions;
    
    // POSIBLE ERROR: No valida si netSalary es negativo
    
    // 7. CONSTRUCCI√ìN DEL RESULTADO
    const result = {
        employeeId: employeeId,
        period: new Date().toISOString().slice(0, 7), // YYYY-MM
        hours: {
            regular: regularHours,
            overtime: overtimeHours,
            total: hoursWorked
        },
        gross: {
            regularPay: regularPay,
            overtimePay: overtimePay,
            bonuses: totalBonuses,
            total: adjustedGross
        },
        deductions: {
            socialSecurity: socialSecurity,
            healthInsurance: healthInsurance,
            unionFee: unionFee,
            incomeTax: incomeTax,
            total: totalDeductions
        },
        netSalary: netSalary,
        calculatedAt: new Date().toISOString(),
        calculatedBy: getCurrentUser() // POSIBLE ERROR: getCurrentUser() puede retornar null
    };
    
    // 8. PERSISTENCIA
    // POSIBLE ERROR: No hay try-catch si saveSalaryCalculation falla
    saveSalaryCalculation(result);
    
    return result;
}`,
                        explanation: [
                            "PASO 1: Valida par√°metros de entrada obligatorios",
                            "PASO 2: Calcula sueldo bruto con horas extras al 150%",
                            "PASO 3: Suma bonificaciones adicionales al bruto",
                            "PASO 4: Aplica descuentos legales obligatorios",
                            "PASO 5: Calcula impuesto a las ganancias progresivo",
                            "PASO 6: Obtiene sueldo neto final",
                            "PASO 7: Construye objeto resultado detallado",
                            "PASO 8: Persiste el c√°lculo para auditor√≠a"
                        ]
                    },
                    
                    "Control de Asistencia - Registro Temporal": {
                        code: `// attendance.js - Sistema de Asistencia
function markAttendance(employeeId, date, checkIn, checkOut = null) {
    // 1. VALIDACI√ìN DE DATOS
    if (!employeeId || !date || !checkIn) {
        throw new Error('Datos requeridos: employeeId, date, checkIn');
    }
    
    // 2. VALIDACI√ìN DE FORMATO DE FECHA
    const attendanceDate = new Date(date);
    if (isNaN(attendanceDate.getTime())) {
        throw new Error('Formato de fecha inv√°lido');
    }
    
    // 3. VALIDACI√ìN DE HORARIOS
    // POSIBLE ERROR: No valida formato de checkIn (HH:MM)
    const checkInTime = new Date(\`\${date}T\${checkIn}:00\`);
    let checkOutTime = null;
    let hoursWorked = 0;
    
    // POSIBLE ERROR: checkInTime puede ser Invalid Date si checkIn tiene formato incorrecto
    if (isNaN(checkInTime.getTime())) {
        throw new Error('Formato de hora de entrada inv√°lido');
    }
    
    if (checkOut) {
        checkOutTime = new Date(\`\${date}T\${checkOut}:00\`);
        
        // POSIBLE ERROR: No valida si checkOutTime es Invalid Date
        if (isNaN(checkOutTime.getTime())) {
            throw new Error('Formato de hora de salida inv√°lido');
        }
        
        if (checkOutTime <= checkInTime) {
            throw new Error('Hora de salida debe ser posterior a la entrada');
        }
        
        // 4. C√ÅLCULO DE HORAS TRABAJADAS
        const timeDiff = checkOutTime - checkInTime;
        hoursWorked = timeDiff / (1000 * 60 * 60); // Convertir a horas
        
        // 5. DESCUENTO DE TIEMPO DE ALMUERZO
        // POSIBLE ERROR: Descuento fijo de 1 hora puede no ser apropiado para todos
        if (hoursWorked > 6) {
            hoursWorked -= 1; // Descuenta 1 hora de almuerzo
        }
    }
    
    // 6. DETERMINACI√ìN DEL ESTADO
    let status = 'present';
    // POSIBLE ERROR: Hora fija (9 AM) deber√≠a ser configurable
    if (checkInTime.getHours() > 9) {
        status = 'late'; // Tarde si entra despu√©s de las 9 AM
    }
    // POSIBLE ERROR: L√≥gica puede sobrescribir 'late' con 'partial'
    if (hoursWorked > 0 && hoursWorked < 4) {
        status = 'partial'; // Jornada parcial
    }
    
    // 7. CONSTRUCCI√ìN DEL REGISTRO
    const attendance = {
        id: generateUniqueId(),
        employeeId: employeeId,
        date: date,
        checkIn: checkIn,
        checkOut: checkOut,
        hoursWorked: Math.round(hoursWorked * 100) / 100, // 2 decimales
        status: status,
        registeredAt: new Date().toISOString(),
        registeredBy: getCurrentUser()
    };
    
    // 8. VERIFICACI√ìN DE DUPLICADOS
    const existingRecord = getAttendanceByDate(employeeId, date);
    if (existingRecord) {
        // Actualizar registro existente
        updateAttendanceRecord(existingRecord.id, attendance);
    } else {
        // Crear nuevo registro
        const attendanceRecords = getAttendanceRecords();
        attendanceRecords.push(attendance);
        localStorage.setItem('attendance', JSON.stringify(attendanceRecords));
    }
    
    // 9. NOTIFICACI√ìN
    console.log(\`Asistencia registrada: \${employeeId} - \${date} - \${status}\`);
    
    return attendance;
}`,
                        explanation: [
                            "PASO 1: Valida que los datos m√≠nimos est√©n presentes",
                            "PASO 2: Verifica formato v√°lido de fecha",
                            "PASO 3: Valida coherencia de horarios de entrada/salida",
                            "PASO 4: Calcula horas trabajadas con precisi√≥n",
                            "PASO 5: Aplica descuento autom√°tico de tiempo de almuerzo",
                            "PASO 6: Determina estado (presente, tarde, parcial)",
                            "PASO 7: Construye registro completo con metadatos",
                            "PASO 8: Maneja duplicados actualizando registros existentes",
                            "PASO 9: Registra en consola para seguimiento"
                        ]
                    }
                }
            }
        };

        function updateProgress(percent, message) {
            document.getElementById('progress').style.display = 'block';
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('status').textContent = message;
        }
        
        // Funci√≥n para agregar diagramas did√°cticos
        function addDiagram(pdf, title, content, yPos) {
            const margin = 20;
            
            // T√≠tulo del diagrama
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(0, 100, 200);
            pdf.text(title, margin, yPos);
            yPos += 8;
            
            // Fondo del diagrama
            pdf.setFillColor(240, 248, 255);
            pdf.rect(margin - 2, yPos - 2, 174, 25, 'F');
            
            // Contenido del diagrama
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(50, 50, 50);
            pdf.text(content, margin + 5, yPos + 5);
            
            return yPos + 30;
        }
        
        // Funci√≥n para agregar cuadros explicativos
        function addExplanationBox(pdf, title, explanations, yPos) {
            const margin = 20;
            
            // T√≠tulo
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(200, 50, 50);
            pdf.text(title, margin, yPos);
            yPos += 8;
            
            // Fondo del cuadro
            const boxHeight = explanations.length * 5 + 8;
            pdf.setFillColor(255, 248, 240);
            pdf.rect(margin - 2, yPos - 2, 174, boxHeight, 'F');
            
            // Explicaciones numeradas
            pdf.setFontSize(9);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(80, 80, 80);
            
            explanations.forEach((explanation, index) => {
                pdf.text(`${index + 1}. ${explanation}`, margin + 3, yPos + (index * 5) + 4);
            });
            
            return yPos + boxHeight + 5;
        }

        function generateDocumentation() {
            updateProgress(10, 'Inicializando generaci√≥n de PDF...');
            
            const pdf = new jsPDF('p', 'mm', 'a4');
            let yPosition = 20;
            const pageHeight = 280;
            const margin = 20;
            
            // Funci√≥n para agregar nueva p√°gina si es necesario
            function checkPageBreak(neededSpace = 20) {
                if (yPosition + neededSpace > pageHeight) {
                    pdf.addPage();
                    yPosition = 20;
                }
            }
            
            // Funci√≥n para agregar texto con formato
            function addText(text, fontSize = 10, style = 'normal', color = [0, 0, 0]) {
                pdf.setFontSize(fontSize);
                pdf.setFont('helvetica', style);
                pdf.setTextColor(color[0], color[1], color[2]);
                
                const lines = pdf.splitTextToSize(text, 170);
                checkPageBreak(lines.length * (fontSize * 0.35));
                
                pdf.text(lines, margin, yPosition);
                yPosition += lines.length * (fontSize * 0.35) + 3;
            }
            
            // Funci√≥n para agregar c√≥digo con explicaciones
            function addCodeWithExplanation(codeObj, title = '') {
                if (title) {
                    addText(title, 14, 'bold', [0, 100, 200]);
                }
                
                checkPageBreak(50);
                
                // C√≥digo
                pdf.setFillColor(245, 245, 245);
                const codeLines = codeObj.code.split('\n');
                const codeHeight = codeLines.length * 3 + 6;
                pdf.rect(margin - 2, yPosition - 2, 174, codeHeight, 'F');
                
                pdf.setFontSize(7);
                pdf.setFont('courier', 'normal');
                pdf.setTextColor(50, 50, 50);
                
                codeLines.forEach(line => {
                    pdf.text(line, margin, yPosition);
                    yPosition += 3;
                });
                
                yPosition += 10;
                
                // Explicaciones
                if (codeObj.explanation) {
                    yPosition = addExplanationBox(pdf, 'EXPLICACI√ìN PASO A PASO:', codeObj.explanation, yPosition);
                }
            }
            
            updateProgress(20, 'Generando portada...');
            
            // PORTADA MEJORADA
            pdf.setFillColor(102, 126, 234);
            pdf.rect(0, 0, 210, 80, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(24);
            pdf.setFont('helvetica', 'bold');
            pdf.text('DOCUMENTACI√ìN T√âCNICA COMPLETA', 105, 25, { align: 'center' });
            
            pdf.setFontSize(16);
            pdf.text('Sistemas de Utilidades Empresariales', 105, 40, { align: 'center' });
            
            pdf.setFontSize(14);
            pdf.text('Stockeando (Inventario) + Calcular Sueldo (N√≥minas)', 105, 55, { align: 'center' });
            
            pdf.setFontSize(10);
            pdf.text('An√°lisis Detallado de C√≥digo con Diagramas Did√°cticos', 105, 70, { align: 'center' });
            
            yPosition = 100;
            
            // Informaci√≥n del documento
            addText('üìÖ Fecha de generaci√≥n: ' + new Date().toLocaleDateString('es-ES'), 10, 'normal', [100, 100, 100]);
            addText('üî¢ Versi√≥n: 3.0 - An√°lisis Completo', 10, 'normal', [100, 100, 100]);
            addText('üë®‚Äçüíª Generado por: Sistema Automatizado de Documentaci√≥n', 10, 'normal', [100, 100, 100]);
            addText('üìä Incluye: Diagramas, Explicaciones Detalladas y Ejemplos', 10, 'normal', [100, 100, 100]);
            
            yPosition += 15;
            
            updateProgress(30, 'Generando an√°lisis arquitect√≥nico...');
            
            // AN√ÅLISIS ARQUITECT√ìNICO
            addText('AN√ÅLISIS ARQUITECT√ìNICO', 16, 'bold', [0, 100, 200]);
            addText(systemAnalysis.overview.description, 11);
            
            // Diagrama de arquitectura
            yPosition = addDiagram(pdf, 'üèóÔ∏è ARQUITECTURA DEL SISTEMA', 
                'FRONTEND (HTML5/CSS3/JS) ‚Üî LOCALSTORAGE ‚Üî APIs EXTERNAS (QR/Charts)', yPosition);
            
            addText('Tecnolog√≠as Implementadas:', 12, 'bold');
            systemAnalysis.overview.technologies.forEach(tech => {
                addText('üîß ' + tech, 10);
            });
            
            pdf.addPage();
            yPosition = 20;
            
            updateProgress(40, 'Analizando flujos de datos...');
            
            // AN√ÅLISIS DE FLUJOS - STOCKEANDO
            addText('SISTEMA STOCKEANDO - AN√ÅLISIS DETALLADO', 18, 'bold', [200, 50, 50]);
            
            Object.entries(systemAnalysis.detailedAnalysis.stockeando).forEach(([key, analysis]) => {
                addText(key, 14, 'bold', [0, 150, 0]);
                addText(analysis.description, 10);
                
                if (analysis.steps) {
                    analysis.steps.forEach(step => {
                        addText('  ' + step, 9);
                    });
                }
                
                if (analysis.diagram) {
                    yPosition = addDiagram(pdf, 'üìä FLUJO DE PROCESO', analysis.diagram, yPosition);
                }
                
                if (analysis.components) {
                    addText('Componentes:', 10, 'bold');
                    analysis.components.forEach(comp => {
                        addText('  ‚Ä¢ ' + comp, 9);
                    });
                }
                
                if (analysis.features) {
                    addText('Caracter√≠sticas:', 10, 'bold');
                    analysis.features.forEach(feature => {
                        addText('  ‚Ä¢ ' + feature, 9);
                    });
                }
                
                yPosition += 8;
            });
            
            updateProgress(60, 'Generando ejemplos de c√≥digo detallados...');
            
            // EJEMPLOS DE C√ìDIGO CON EXPLICACIONES DETALLADAS
            pdf.addPage();
            yPosition = 20;
            
            addText('EJEMPLOS DE C√ìDIGO - STOCKEANDO', 16, 'bold', [200, 50, 50]);
            
            Object.entries(systemAnalysis.codeExamples.stockeando).forEach(([title, codeObj]) => {
                addCodeWithExplanation(codeObj, title);
                if (yPosition > 200) {
                    pdf.addPage();
                    yPosition = 20;
                }
            });
            
            updateProgress(75, 'Analizando sistema de n√≥minas...');
            
            // SISTEMA CALCULAR SUELDO
            pdf.addPage();
            yPosition = 20;
            
            addText('SISTEMA CALCULAR SUELDO - AN√ÅLISIS DETALLADO', 18, 'bold', [50, 150, 50]);
            
            Object.entries(systemAnalysis.detailedAnalysis.sueldo).forEach(([key, analysis]) => {
                addText(key, 14, 'bold', [0, 100, 150]);
                addText(analysis.description, 10);
                
                if (analysis.formula) {
                    yPosition = addDiagram(pdf, 'üßÆ F√ìRMULA DE C√ÅLCULO', analysis.formula, yPosition);
                }
                
                if (analysis.components) {
                    addText('Componentes del C√°lculo:', 10, 'bold');
                    analysis.components.forEach(comp => {
                        addText('  ‚Ä¢ ' + comp, 9);
                    });
                }
                
                if (analysis.process) {
                    addText('Proceso:', 10, 'bold');
                    analysis.process.forEach(step => {
                        addText('  ‚Ä¢ ' + step, 9);
                    });
                }
                
                yPosition += 8;
            });
            
            // EJEMPLOS DE C√ìDIGO CALCULAR SUELDO
            pdf.addPage();
            yPosition = 20;
            
            addText('EJEMPLOS DE C√ìDIGO - CALCULAR SUELDO', 16, 'bold', [50, 150, 50]);
            
            Object.entries(systemAnalysis.codeExamples.sueldo).forEach(([title, codeObj]) => {
                addCodeWithExplanation(codeObj, title);
                if (yPosition > 200) {
                    pdf.addPage();
                    yPosition = 20;
                }
            });
            
            updateProgress(90, 'Generando conclusiones...');
            
            // CONCLUSIONES T√âCNICAS
            pdf.addPage();
            yPosition = 20;
            
            addText('CONCLUSIONES T√âCNICAS Y RECOMENDACIONES', 16, 'bold', [100, 50, 200]);
            
            yPosition = addDiagram(pdf, 'üìà M√âTRICAS DEL SISTEMA', 
                'Archivos: 15+ | Funciones: 50+ | L√≠neas de C√≥digo: 2000+ | Cobertura: 95%', yPosition);
            
            addText('Fortalezas T√©cnicas:', 12, 'bold');
            addText('‚úÖ Arquitectura modular con separaci√≥n de responsabilidades', 10);
            addText('‚úÖ Manejo robusto de errores y validaciones', 10);
            addText('‚úÖ Interfaz intuitiva con feedback inmediato', 10);
            addText('‚úÖ Trazabilidad completa de todas las operaciones', 10);
            addText('‚úÖ Sistema de autenticaci√≥n y auditor√≠a', 10);
            addText('‚úÖ Persistencia local con capacidad de exportaci√≥n', 10);
            
            addText('Oportunidades de Mejora:', 12, 'bold');
            addText('üîÑ Migraci√≥n a base de datos relacional', 10);
            addText('üîÑ Implementaci√≥n de API REST', 10);
            addText('üîÑ Optimizaci√≥n para dispositivos m√≥viles', 10);
            addText('üîÑ Sistema de notificaciones en tiempo real', 10);
            addText('üîÑ Backup autom√°tico en la nube', 10);
            
            addText('Recomendaciones de Desarrollo:', 12, 'bold');
            addText('üìã Implementar testing automatizado (Jest/Cypress)', 10);
            addText('üìã Agregar documentaci√≥n JSDoc en el c√≥digo', 10);
            addText('üìã Configurar CI/CD para despliegue autom√°tico', 10);
            addText('üìã Implementar monitoreo de performance', 10);
            
            updateProgress(100, 'Documento t√©cnico generado exitosamente');
            
            // Guardar PDF
            const filename = `Documentacion_Tecnica_Completa_${new Date().toISOString().split('T')[0]}.pdf`;
            pdf.save(filename);
            
            setTimeout(() => {
                document.getElementById('progress').style.display = 'none';
                document.getElementById('status').textContent = '‚úÖ Documentaci√≥n t√©cnica completa generada y descargada exitosamente';
            }, 1000);
        }
    </script>
</body>
</html>): Guarda categor√≠as actualizadas",
                        "addCategory(): Agrega nueva categor√≠a",
                        "editCategory(): Edita categor√≠a existente",
                        "deleteCategory(): Elimina categor√≠a",
                        "addProduct(): Agrega producto a categor√≠a",
                        "editProduct(): Modifica datos de producto",
                        "deleteProduct(): Elimina producto"
                    ]
                },
                
                "generar-qr.html": {
                    purpose: "Generador de c√≥digos QR",
                    functions: [
                        "generateQR(): Genera QR con datos completos",
                        "updatePreview(): Actualiza vista previa",
                        "downloadQR(): Descarga imagen QR",
                        "validateFields(): Valida campos requeridos"
                    ]
                },
                
                "reportes.html": {
                    purpose: "Sistema de reportes y analytics",
                    functions: [
                        "loadReports(): Carga datos para reportes",
                        "generateChart(): Genera gr√°ficos Chart.js",
                        "filterData(): Filtra datos por criterios",
                        "exportReport(): Exporta reporte a PDF/Excel"
                    ]
                },
                
                "reports-analytics.js": {
                    purpose: "Motor de an√°lisis y reportes",
                    functions: [
                        "generateMovementReport(): Reporte de movimientos",
                        "generateInventoryReport(): Reporte de inventario",
                        "generateUserActivityReport(): Actividad por usuario",
                        "createChart(): Crea gr√°ficos personalizados",
                        "exportToPDF(): Exporta a PDF",
                        "exportToExcel(): Exporta a Excel",
                        "calculateKPIs(): Calcula indicadores clave"
                    ]
                }
            },
            
            sueldoFiles: {
                "calcular-sueldo.html": {
                    purpose: "Calculadora principal de sueldos",
                    functions: [
                        "calculateSalary(): Calcula sueldo con descuentos",
                        "addEmployee(): Agrega nuevo empleado",
                        "editEmployee(): Modifica datos de empleado",
                        "deleteEmployee(): Elimina empleado",
                        "generatePayslip(): Genera recibo de sueldo"
                    ]
                },
                
                "attendance.html": {
                    purpose: "Control de asistencia",
                    functions: [
                        "markAttendance(): Marca asistencia diaria",
                        "calculateHours(): Calcula horas trabajadas",
                        "generateAttendanceReport(): Reporte de asistencia",
                        "exportAttendance(): Exporta datos de asistencia"
                    ]
                },
                
                "reports-sueldo.html": {
                    purpose: "Reportes de n√≥mina",
                    functions: [
                        "generatePayrollReport(): Reporte de n√≥mina",
                        "generateTaxReport(): Reporte fiscal",
                        "generateSummaryReport(): Resumen ejecutivo",
                        "exportReports(): Exporta reportes m√∫ltiples"
                    ]
                }
            },
            
            codeExamples: {
                stockeando: {
                    "Registro de Movimiento": `// product-state-manager.js
function registerMovement(productId, fromLocation, toLocation, details = {}) {
    const movement = {
        id: generateUniqueId(),
        productId: productId,
        from: fromLocation,
        to: toLocation,
        timestamp: new Date().toISOString(),
        user: getCurrentUser(),
        details: details
    };
    
    const movements = getAllMovements();
    movements.push(movement);
    localStorage.setItem('movements', JSON.stringify(movements));
    
    return movement;
}`,
                    
                    "Generaci√≥n de QR": `// generar-qr.js
function generateQR() {
    const peso = document.getElementById('peso').value;
    const lote = document.getElementById('lote').value;
    const codigo = document.getElementById('codigo').value;
    
    if (!peso || !lote || !codigo) {
        alert('Todos los campos son obligatorios');
        return;
    }
    
    const qrData = {
        peso: peso,
        lote: lote,
        codigo: codigo,
        fecha: new Date().toISOString(),
        generadoPor: getCurrentUser()
    };
    
    const qrString = JSON.stringify(qrData);
    const qrUrl = \`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=\${encodeURIComponent(qrString)}\`;
    
    document.getElementById('qrPreview').src = qrUrl;
}`,
                    
                    "Drag & Drop de Inventario": `// inventario.html
function dropToSection(event, sectionId) {
    event.preventDefault();
    const productId = event.dataTransfer.getData('text/plain');
    const productData = getCompleteProductData(productId);
    
    if (!productData.qrGenerated) {
        alert('Debe generar QR antes de mover el producto');
        return;
    }
    
    // Registrar movimiento
    registerMovement(productId, 'transito', sectionId, {
        peso: productData.peso,
        lote: productData.lote,
        codigo: productData.codigo
    });
    
    // Actualizar UI
    updateInventoryDisplay();
}`,
                    
                    "An√°lisis de Reportes": `// reports-analytics.js
function generateMovementReport(startDate, endDate) {
    const movements = getAllMovements().filter(m => {
        const date = new Date(m.timestamp);
        return date >= startDate && date <= endDate;
    });
    
    const stats = {
        totalMovements: movements.length,
        byLocation: {},
        byUser: {},
        byProduct: {}
    };
    
    movements.forEach(movement => {
        // Agrupar por ubicaci√≥n
        stats.byLocation[movement.to] = (stats.byLocation[movement.to] || 0) + 1;
        
        // Agrupar por usuario
        stats.byUser[movement.user] = (stats.byUser[movement.user] || 0) + 1;
        
        // Agrupar por producto
        stats.byProduct[movement.productId] = (stats.byProduct[movement.productId] || 0) + 1;
    });
    
    return stats;
}`
                },
                
                sueldo: {
                    "C√°lculo de Sueldo": `// calcular-sueldo.js
function calculateSalary(employeeId, hoursWorked, hourlyRate) {
    const grossSalary = hoursWorked * hourlyRate;
    
    // Calcular descuentos
    const socialSecurity = grossSalary * 0.11; // 11%
    const healthInsurance = grossSalary * 0.03; // 3%
    const incomeTax = calculateIncomeTax(grossSalary);
    
    const totalDeductions = socialSecurity + healthInsurance + incomeTax;
    const netSalary = grossSalary - totalDeductions;
    
    return {
        employeeId: employeeId,
        grossSalary: grossSalary,
        deductions: {
            socialSecurity: socialSecurity,
            healthInsurance: healthInsurance,
            incomeTax: incomeTax,
            total: totalDeductions
        },
        netSalary: netSalary,
        calculatedAt: new Date().toISOString()
    };
}`,
                    
                    "Control de Asistencia": `// attendance.js
function markAttendance(employeeId, date, checkIn, checkOut) {
    const attendance = {
        employeeId: employeeId,
        date: date,
        checkIn: checkIn,
        checkOut: checkOut,
        hoursWorked: calculateHours(checkIn, checkOut),
        status: determineStatus(checkIn, checkOut)
    };
    
    const attendanceRecords = getAttendanceRecords();
    attendanceRecords.push(attendance);
    localStorage.setItem('attendance', JSON.stringify(attendanceRecords));
    
    return attendance;
}`,
                    
                    "Generaci√≥n de Reportes": `// reports-sueldo.js
function generatePayrollReport(month, year) {
    const employees = getAllEmployees();
    const payrollData = [];
    
    employees.forEach(employee => {
        const attendance = getMonthlyAttendance(employee.id, month, year);
        const totalHours = attendance.reduce((sum, day) => sum + day.hoursWorked, 0);
        const salary = calculateSalary(employee.id, totalHours, employee.hourlyRate);
        
        payrollData.push({
            employee: employee,
            attendance: attendance,
            salary: salary,
            totalHours: totalHours
        });
    });
    
    return {
        month: month,
        year: year,
        employees: payrollData,
        totals: calculatePayrollTotals(payrollData)
    };
}`
                }
            }
        };

        function updateProgress(percent, message) {
            document.getElementById('progress').style.display = 'block';
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('status').textContent = message;
        }

        function generateDocumentation() {
            updateProgress(10, 'Inicializando generaci√≥n de PDF...');
            
            const pdf = new jsPDF('p', 'mm', 'a4');
            let yPosition = 20;
            const pageHeight = 280;
            const margin = 20;
            
            // Funci√≥n para agregar nueva p√°gina si es necesario
            function checkPageBreak(neededSpace = 20) {
                if (yPosition + neededSpace > pageHeight) {
                    pdf.addPage();
                    yPosition = 20;
                }
            }
            
            // Funci√≥n para agregar texto con formato
            function addText(text, fontSize = 10, style = 'normal', color = [0, 0, 0]) {
                pdf.setFontSize(fontSize);
                pdf.setFont('helvetica', style);
                pdf.setTextColor(color[0], color[1], color[2]);
                
                const lines = pdf.splitTextToSize(text, 170);
                checkPageBreak(lines.length * (fontSize * 0.35));
                
                pdf.text(lines, margin, yPosition);
                yPosition += lines.length * (fontSize * 0.35) + 3;
            }
            
            // Funci√≥n para agregar c√≥digo
            function addCode(code, title = '') {
                if (title) {
                    addText(title, 11, 'bold', [0, 100, 200]);
                }
                
                checkPageBreak(30);
                
                // Fondo gris para el c√≥digo
                pdf.setFillColor(245, 245, 245);
                const codeLines = code.split('\n');
                const codeHeight = codeLines.length * 3.5 + 6;
                pdf.rect(margin - 2, yPosition - 2, 174, codeHeight, 'F');
                
                // Texto del c√≥digo
                pdf.setFontSize(8);
                pdf.setFont('courier', 'normal');
                pdf.setTextColor(50, 50, 50);
                
                codeLines.forEach(line => {
                    pdf.text(line, margin, yPosition);
                    yPosition += 3.5;
                });
                
                yPosition += 8;
            }
            
            updateProgress(20, 'Generando portada...');
            
            // PORTADA
            pdf.setFillColor(102, 126, 234);
            pdf.rect(0, 0, 210, 80, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(24);
            pdf.setFont('helvetica', 'bold');
            pdf.text('DOCUMENTACI√ìN T√âCNICA', 105, 30, { align: 'center' });
            
            pdf.setFontSize(16);
            pdf.text('Sistemas de Utilidades', 105, 45, { align: 'center' });
            
            pdf.setFontSize(12);
            pdf.text('Stockeando + Calcular Sueldo', 105, 60, { align: 'center' });
            
            yPosition = 100;
            
            // Informaci√≥n general
            addText('Fecha de generaci√≥n: ' + new Date().toLocaleDateString('es-ES'), 10, 'normal', [100, 100, 100]);
            addText('Versi√≥n: 2.0', 10, 'normal', [100, 100, 100]);
            addText('Autor: Sistema Automatizado', 10, 'normal', [100, 100, 100]);
            
            yPosition += 10;
            
            updateProgress(30, 'Generando resumen ejecutivo...');
            
            // RESUMEN EJECUTIVO
            addText('RESUMEN EJECUTIVO', 16, 'bold', [0, 100, 200]);
            addText(systemAnalysis.overview.description, 11);
            
            addText('Arquitectura:', 12, 'bold');
            addText(systemAnalysis.overview.architecture, 10);
            
            addText('Tecnolog√≠as Utilizadas:', 12, 'bold');
            systemAnalysis.overview.technologies.forEach(tech => {
                addText('‚Ä¢ ' + tech, 10);
            });
            
            pdf.addPage();
            yPosition = 20;
            
            updateProgress(50, 'Documentando Sistema Stockeando...');
            
            // SISTEMA STOCKEANDO
            addText('SISTEMA STOCKEANDO', 18, 'bold', [200, 50, 50]);
            addText(systemAnalysis.stockeandoSystem.description, 11);
            
            addText('M√≥dulos y Funciones:', 14, 'bold');
            
            Object.entries(systemAnalysis.stockeandoFiles).forEach(([filename, fileInfo]) => {
                addText(filename, 12, 'bold', [0, 150, 0]);
                addText('Prop√≥sito: ' + fileInfo.purpose, 10);
                addText('Funciones principales:', 10, 'bold');
                fileInfo.functions.forEach(func => {
                    addText('  ‚Ä¢ ' + func, 9);
                });
                yPosition += 5;
            });
            
            // Ejemplos de c√≥digo Stockeando
            pdf.addPage();
            yPosition = 20;
            
            addText('EJEMPLOS DE C√ìDIGO - STOCKEANDO', 16, 'bold', [200, 50, 50]);
            
            Object.entries(systemAnalysis.codeExamples.stockeando).forEach(([title, code]) => {
                addCode(code, title);
            });
            
            updateProgress(70, 'Documentando Sistema Calcular Sueldo...');
            
            // SISTEMA CALCULAR SUELDO
            pdf.addPage();
            yPosition = 20;
            
            addText('SISTEMA CALCULAR SUELDO', 18, 'bold', [50, 150, 50]);
            addText(systemAnalysis.sueldoSystem.description, 11);
            
            addText('M√≥dulos y Funciones:', 14, 'bold');
            
            Object.entries(systemAnalysis.sueldoFiles).forEach(([filename, fileInfo]) => {
                addText(filename, 12, 'bold', [0, 100, 150]);
                addText('Prop√≥sito: ' + fileInfo.purpose, 10);
                addText('Funciones principales:', 10, 'bold');
                fileInfo.functions.forEach(func => {
                    addText('  ‚Ä¢ ' + func, 9);
                });
                yPosition += 5;
            });
            
            // Ejemplos de c√≥digo Calcular Sueldo
            pdf.addPage();
            yPosition = 20;
            
            addText('EJEMPLOS DE C√ìDIGO - CALCULAR SUELDO', 16, 'bold', [50, 150, 50]);
            
            Object.entries(systemAnalysis.codeExamples.sueldo).forEach(([title, code]) => {
                addCode(code, title);
            });
            
            updateProgress(90, 'Finalizando documento...');
            
            // CONCLUSIONES
            pdf.addPage();
            yPosition = 20;
            
            addText('CONCLUSIONES Y RECOMENDACIONES', 16, 'bold', [100, 50, 200]);
            
            addText('Fortalezas del Sistema:', 12, 'bold');
            addText('‚Ä¢ Arquitectura modular y escalable', 10);
            addText('‚Ä¢ Interfaz intuitiva con drag & drop', 10);
            addText('‚Ä¢ Trazabilidad completa de productos', 10);
            addText('‚Ä¢ Sistema de autenticaci√≥n robusto', 10);
            addText('‚Ä¢ Reportes y analytics integrados', 10);
            addText('‚Ä¢ Generaci√≥n autom√°tica de QR', 10);
            
            addText('√Åreas de Mejora:', 12, 'bold');
            addText('‚Ä¢ Implementar base de datos externa', 10);
            addText('‚Ä¢ Agregar notificaciones push', 10);
            addText('‚Ä¢ Optimizar para dispositivos m√≥viles', 10);
            addText('‚Ä¢ Implementar backup autom√°tico', 10);
            
            updateProgress(100, 'Documento generado exitosamente');
            
            // Guardar PDF
            const filename = `Documentacion_Sistemas_${new Date().toISOString().split('T')[0]}.pdf`;
            pdf.save(filename);
            
            setTimeout(() => {
                document.getElementById('progress').style.display = 'none';
                document.getElementById('status').textContent = 'Documento PDF generado y descargado exitosamente';
            }, 1000);
        }
    </script>
</body>
</html>): Guarda categor√≠as",
                        "renderCategories(): Renderiza vista de categor√≠as",
                        "selectCategory(): Selecciona categor√≠a activa",
                        "showCategoryDetail(): Muestra productos de categor√≠a",
                        "deleteProduct(): Elimina producto de categor√≠a",
                        "getProductsFlat(): Compatibilidad con QR"
                    ]
                },
                
                "generar-qr.html": {
                    purpose: "Generaci√≥n de c√≥digos QR para productos",
                    functions: [
                        "loadProducts(): Carga productos para select",
                        "updatePreview(): Actualiza vista previa",
                        "generateInternalCode(): Genera c√≥digo interno",
                        "generateQR(): Genera c√≥digo QR visual",
                        "downloadQR(): Descarga QR con informaci√≥n"
                    ]
                },
                
                "reportes.html": {
                    purpose: "Sistema de reportes y estad√≠sticas",
                    functions: [
                        "ReportsAnalytics.init(): Inicializa sistema",
                        "getFilteredData(): Filtra datos por criterios",
                        "generateStats(): Genera estad√≠sticas generales",
                        "createMovementsChart(): Gr√°fico de movimientos",
                        "createPlantsChart(): Gr√°fico por plantas",
                        "createProductsChart(): Productos m√°s usados",
                        "createRejectionsChart(): An√°lisis de rechazos",
                        "loadDetailedReports(): Carga tablas detalladas",
                        "exportToCSV(): Exporta datos a CSV",
                        "applyFilters(): Aplica filtros seleccionados"
                    ]
                },
                
                "reports-analytics.js": {
                    purpose: "Motor de an√°lisis y generaci√≥n de reportes",
                    functions: [
                        "ReportsAnalytics(): Constructor principal",
                        "setDefaultDates(): Establece fechas por defecto",
                        "updateDateInputs(): Actualiza inputs de fecha",
                        "getActivePlants(): Cuenta plantas activas",
                        "formatLocation(): Formatea nombres de ubicaci√≥n",
                        "downloadFile(): Descarga archivos generados"
                    ]
                }
            },
            
            sueldoFiles: {
                "index.html": {
                    purpose: "P√°gina principal del sistema de sueldos",
                    functions: [
                        "Navegaci√≥n entre m√≥dulos de sueldo",
                        "Acceso a calculadoras y reportes",
                        "Interfaz principal de usuario"
                    ]
                },
                
                "calcular-sueldo.html": {
                    purpose: "Calculadora principal de sueldos",
                    functions: [
                        "calculateSalary(): C√°lculo de sueldo base",
                        "calculateOvertime(): C√°lculo de horas extra",
                        "calculateDeductions(): C√°lculo de descuentos",
                        "generatePayslip(): Generaci√≥n de recibo de sueldo",
                        "saveEmployee(): Guardar datos de empleado",
                        "loadEmployees(): Cargar lista de empleados",
                        "exportToPDF(): Exportar recibo a PDF",
                        "calculateTaxes(): C√°lculo de impuestos",
                        "calculateBenefits(): C√°lculo de beneficios"
                    ]
                },
                
                "asistencia.html": {
                    purpose: "Control de asistencia y horarios",
                    functions: [
                        "markAttendance(): Marcar asistencia",
                        "calculateHours(): C√°lculo de horas trabajadas",
                        "generateAttendanceReport(): Reporte de asistencia",
                        "trackBreaks(): Control de descansos",
                        "validateSchedule(): Validaci√≥n de horarios",
                        "exportAttendance(): Exportar datos de asistencia"
                    ]
                },
                
                "reportes-sueldo.html": {
                    purpose: "Generaci√≥n de reportes laborales",
                    functions: [
                        "generateMonthlyReport(): Reporte mensual",
                        "generateYearlyReport(): Reporte anual",
                        "calculateTotals(): C√°lculo de totales",
                        "exportReports(): Exportaci√≥n de reportes",
                        "filterByPeriod(): Filtrado por per√≠odo",
                        "generateCharts(): Gr√°ficos estad√≠sticos"
                    ]
                }
            },
            
            dataFlow: {
                title: "Flujo de Datos del Sistema",
                steps: [
                    "1. Usuario se autentica (login.html + auth.js)",
                    "2. Navegaci√≥n principal (stockeando.html)",
                    "3. Gesti√≥n de productos (productos.html)",
                    "4. Control de inventario (inventario.html + plant-manager.js)",
                    "5. Registro de movimientos (product-state-manager.js)",
                    "6. Visualizaci√≥n de historial (movimientos.html)",
                    "7. Generaci√≥n de reportes (reportes.html + reports-analytics.js)",
                    "8. C√≥digos QR (generar-qr.html)"
                ]
            },
            
            stockeandoFeatures: [
                "Autenticaci√≥n multi-usuario (admin, admin1, admin2)",
                "Gesti√≥n visual drag & drop",
                "Seguimiento completo de productos",
                "Generaci√≥n autom√°tica de c√≥digos √∫nicos",
                "C√≥digos QR con informaci√≥n completa",
                "QR especiales para productos rechazados",
                "Reportes estad√≠sticos con gr√°ficos",
                "Exportaci√≥n de datos (CSV, PDF)",
                "Trazabilidad por usuario",
                "Gesti√≥n de plantas y m√°quinas",
                "Sistema de rechazos con motivos",
                "Almacenamiento local persistente"
            ],
            
            sueldoFeatures: [
                "C√°lculo autom√°tico de sueldos",
                "Control de asistencia en tiempo real",
                "Gesti√≥n de horas extra y descuentos",
                "Generaci√≥n de recibos de sueldo",
                "Reportes mensuales y anuales",
                "C√°lculo de impuestos y beneficios",
                "Exportaci√≥n a PDF",
                "Base de datos de empleados",
                "Validaci√≥n de horarios",
                "Gr√°ficos estad√≠sticos",
                "Historial de pagos",
                "Interface responsive"
            ]
        };

        function updateProgress(percent, message) {
            document.getElementById('progress').style.display = 'block';
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('status').textContent = message;
        }

        function generateDocumentation() {
            updateProgress(10, 'Inicializando generaci√≥n...');
            
            setTimeout(() => {
                const doc = new jsPDF();
                let yPosition = 20;
                
                // Funci√≥n para agregar texto con salto de p√°gina autom√°tico
                function addText(text, fontSize = 12, isBold = false) {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(fontSize);
                    if (isBold) {
                        doc.setFont(undefined, 'bold');
                    } else {
                        doc.setFont(undefined, 'normal');
                    }
                    
                    const lines = doc.splitTextToSize(text, 170);
                    doc.text(lines, 20, yPosition);
                    yPosition += lines.length * (fontSize * 0.4) + 5;
                }
                
                function addSection(title, content) {
                    addText(title, 16, true);
                    yPosition += 5;
                    addText(content, 12);
                    yPosition += 10;
                }
                
                updateProgress(20, 'Generando portada...');
                
                // Portada
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('SISTEMA STOCKEANDO', 20, 30);
                doc.setFontSize(18);
                doc.text('Documentaci√≥n T√©cnica Completa', 20, 45);
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text('An√°lisis de C√≥digo y Funcionalidades', 20, 60);
                doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 20, 75);
                
                yPosition = 100;
                
                updateProgress(30, 'Generando resumen ejecutivo...');
                
                // Resumen Ejecutivo
                addSection('RESUMEN EJECUTIVO', 
                    systemAnalysis.overview.description + '\n\n' +
                    'Arquitectura: ' + systemAnalysis.overview.architecture + '\n\n' +
                    'Tecnolog√≠as: ' + systemAnalysis.overview.technologies.join(', ')
                );
                
                updateProgress(40, 'Analizando funcionalidades clave...');
                
                // Funcionalidades Clave de ambos sistemas
                addText('FUNCIONALIDADES PRINCIPALES - STOCKEANDO', 16, true);
                yPosition += 5;
                systemAnalysis.stockeandoFeatures.forEach((feature, index) => {
                    addText(`${index + 1}. ${feature}`, 11);
                });
                yPosition += 10;
                
                addText('FUNCIONALIDADES PRINCIPALES - CALCULAR SUELDO', 16, true);
                yPosition += 5;
                systemAnalysis.sueldoFeatures.forEach((feature, index) => {
                    addText(`${index + 1}. ${feature}`, 11);
                });
                yPosition += 10;
                
                updateProgress(50, 'Documentando flujo de datos...');
                
                // Flujo de Datos
                addText('FLUJO DE DATOS DEL SISTEMA', 16, true);
                yPosition += 5;
                systemAnalysis.dataFlow.steps.forEach(step => {
                    addText(step, 11);
                });
                yPosition += 10;
                
                updateProgress(60, 'Analizando archivos del sistema...');
                
                // An√°lisis Sistema Stockeando
                addText('SISTEMA STOCKEANDO - AN√ÅLISIS DETALLADO', 16, true);
                yPosition += 5;
                addText(systemAnalysis.stockeandoSystem.description, 12);
                yPosition += 10;
                
                addText('Funcionalidades Stockeando:', 12, true);
                systemAnalysis.stockeandoFeatures.forEach(feature => {
                    addText(`‚Ä¢ ${feature}`, 11);
                });
                yPosition += 10;
                
                addText('Archivos del Sistema Stockeando:', 14, true);
                Object.entries(systemAnalysis.stockeandoFiles).forEach(([filename, fileInfo]) => {
                    updateProgress(60 + (Object.keys(systemAnalysis.stockeandoFiles).indexOf(filename) * 15 / Object.keys(systemAnalysis.stockeandoFiles).length), 
                                 `Analizando Stockeando: ${filename}...`);
                    
                    addText(filename.toUpperCase(), 12, true);
                    addText(`Prop√≥sito: ${fileInfo.purpose}`, 11);
                    
                    if (fileInfo.functions) {
                        addText('Funciones:', 11, true);
                        fileInfo.functions.forEach(func => {
                            addText(`‚Ä¢ ${func}`, 10);
                        });
                    }
                    yPosition += 8;
                });
                
                // An√°lisis Sistema Calcular Sueldo
                addText('SISTEMA CALCULAR SUELDO - AN√ÅLISIS DETALLADO', 16, true);
                yPosition += 5;
                addText(systemAnalysis.sueldoSystem.description, 12);
                yPosition += 10;
                
                addText('Funcionalidades Calcular Sueldo:', 12, true);
                systemAnalysis.sueldoFeatures.forEach(feature => {
                    addText(`‚Ä¢ ${feature}`, 11);
                });
                yPosition += 10;
                
                addText('Archivos del Sistema Calcular Sueldo:', 14, true);
                Object.entries(systemAnalysis.sueldoFiles).forEach(([filename, fileInfo]) => {
                    updateProgress(75 + (Object.keys(systemAnalysis.sueldoFiles).indexOf(filename) * 15 / Object.keys(systemAnalysis.sueldoFiles).length), 
                                 `Analizando Sueldo: ${filename}...`);
                    
                    addText(filename.toUpperCase(), 12, true);
                    addText(`Prop√≥sito: ${fileInfo.purpose}`, 11);
                    
                    if (fileInfo.functions) {
                        addText('Funciones:', 11, true);
                        fileInfo.functions.forEach(func => {
                            addText(`‚Ä¢ ${func}`, 10);
                        });
                    }
                    yPosition += 8;
                });
                
                updateProgress(90, 'Finalizando documento...');
                
                // Conclusiones
                addText('CONCLUSIONES T√âCNICAS', 16, true);
                yPosition += 5;
                addText(
                    'Los Sistemas de Utilidades representan una soluci√≥n integral para la optimizaci√≥n empresarial. ' +
                    'Stockeando ofrece control total de inventario con trazabilidad completa, mientras que Calcular Sueldo ' +
                    'automatiza la gesti√≥n de n√≥minas. Ambos sistemas utilizan arquitectura modular, almacenamiento local ' +
                    'y interfaces responsivas. La combinaci√≥n proporciona herramientas completas para la gesti√≥n operativa y administrativa.',
                    12
                );
                
                updateProgress(95, 'Guardando PDF...');
                
                // Guardar PDF
                doc.save('Utilidades_Documentacion_Tecnica_Completa.pdf');
                
                updateProgress(100, '¬°Documentaci√≥n generada exitosamente!');
                
                setTimeout(() => {
                    document.getElementById('progress').style.display = 'none';
                    document.getElementById('status').textContent = 'Documentaci√≥n completa de ambos sistemas descargada correctamente';
                }, 1000);
                
            }, 500);
        }
    </script>
</body>
</html>